<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delta 360 | Dispatch Command Center</title>
  <meta name="description" content="Professional team dispatch command center powered by GroupMe.">
  <meta name="theme-color" content="#f97316">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90' fill='%23f97316'>Î”</text></svg>">
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">
</head>
<body>

  <!-- LOGIN SCREEN -->
  <div id="login" role="dialog" aria-label="Login">
    <div class="login-card">
      <div class="lb" aria-hidden="true">Î”</div>
      <div class="sub">Delta 360</div>
      <div class="input-group">
        <input type="password" id="tok" placeholder="GroupMe API Token" aria-label="GroupMe API Token" onkeydown="if(event.key==='Enter')doLogin()">
        <button class="lbtn" onclick="doLogin()"><span>Connect</span></button>
      </div>
      <div id="lerr"></div>
      <div class="meta-link">
        <a href="https://dev.groupme.com" target="_blank">Get API Token â†’</a>
      </div>
    </div>
  </div>

  <!-- MAIN APPLICATION -->
  <div id="app-root" style="display:none;">
    
    <!-- HEADER -->
    <header role="banner">
      <div class="header-left">
        <button id="menu-btn" class="icon-btn" onclick="tglSidebar()" title="Toggle sidebar" aria-label="Toggle sidebar">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
        </button>
        <div class="brand">
          <div class="brand-icon">Î”</div>
          <div>
            <div class="brand-title" id="htitle">Dashboard</div>
            <div class="brand-subtitle">Delta 360</div>
          </div>
        </div>
      </div>

      <div class="header-right">
        <div class="status-control">
          <button class="status-btn" id="status-btn" onclick="cycleStatus()" title="Your status">
            <span class="status-dot" id="status-dot"></span>
            <span id="status-text">Away</span>
          </button>
        </div>
        <div class="header-divider"></div>

        <button class="icon-btn" onclick="toggleSearch()" title="Search (/)">ğŸ”</button>
        <button class="icon-btn" id="membersBtn" onclick="showMembers()" title="Members">ğŸ‘¥</button>
        <button class="icon-btn" id="sound-btn" onclick="toggleSound()" title="Sound"><span id="sound-icon">ğŸ”Š</span></button>

        <!-- Tools Tray -->
        <div class="menu-wrapper">
          <button class="icon-btn" onclick="tglTray('toolsTray')" title="Tools">âš¡</button>
          <div class="dropdown-menu tray" id="toolsTray">
            <button class="menu-item" onclick="showContacts();closeTray()">ğŸ‘¥ Contacts</button>
            <button class="menu-item" onclick="toggleCB();closeTray()">ğŸ“‹ Clipboard</button>
            <button class="menu-item" onclick="toggleStickyUI();closeTray()">ğŸ“’ Sticky Note</button>
            <button class="menu-item" onclick="openCfg();closeTray()">âš™ï¸ Config</button>
          </div>
        </div>

        <!-- Actions Tray -->
        <div class="menu-wrapper">
          <button class="icon-btn" onclick="tglTray('actionsTray')" title="Actions">ğŸ“¡</button>
          <div class="dropdown-menu tray" id="actionsTray">
            <button class="menu-item" onclick="showAdhoc();closeTray()">ğŸ“¢ Broadcast</button>
            <button class="menu-item" onclick="showShiftChange();closeTray()">ğŸ“‹ Shift Change</button>
            <button class="menu-item" onclick="exportChat();closeTray()">ğŸ’¾ Export Chat</button>
            <button class="menu-item" onclick="exportShiftLog();closeTray()">ğŸ“„ Shift Log</button>
          </div>
        </div>

        <!-- Settings Menu -->
        <div class="menu-wrapper">
          <button class="icon-btn" onclick="tglMenu()" title="More">â‹®</button>
          <div class="dropdown-menu" id="main-menu">
            <button class="menu-item" onclick="toggleTheme();tglMenu()">ğŸŒ™ Theme</button>
            <button class="menu-item" onclick="toggleCompact();tglMenu()">ğŸ“ Compact</button>
            <button class="menu-item" onclick="toggleInputBottom();tglMenu()">â¬‡ï¸ Input Bottom</button>
            <button class="menu-item" onclick="toggleOldestFirst();tglMenu()">â†•ï¸ Oldest First</button>
            <div class="menu-divider"></div>
            <button class="menu-item" onclick="doLogout()">ğŸšª Log Out</button>
          </div>
        </div>
      </div>
    </header>

    <!-- DISPATCH BOARD -->
    <div id="dboard"></div>

    <!-- TEMPLATE BAR -->
    <div id="tpl-bar" class="tpl-bar"></div>

    <!-- STICKY NOTE BAR -->
    <div id="sticky-bar" class="sticky-bar" style="display:none;">
      <div class="sticky-header">
        <span>ğŸ“’ Sticky Note</span>
        <div class="sticky-controls">
          <select id="stickyExp" title="Expiry">
            <option value="0">No expiry</option>
            <option value="1">1 hour</option>
            <option value="4">4 hours</option>
            <option value="8">8 hours</option>
            <option value="24">24 hours</option>
          </select>
          <button class="icon-btn-sm" onclick="showStickyHistory()" title="History">ğŸ“œ</button>
          <button class="icon-btn-sm" onclick="toggleStickyUI()" title="Close">âœ•</button>
        </div>
      </div>
      <textarea id="stickyText" placeholder="Write a note for this channel..."></textarea>
      <button class="sticky-save-btn" onclick="saveSticky()">Save</button>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main">
      
      <!-- SIDEBAR -->
      <nav id="sidebar" aria-label="Main navigation">
        <div class="sidebar-section">
          <div class="section-label">Command</div>
          <div class="sidebar-item" data-chat-action="all" data-chat-id="null">ğŸ“¡ Universal Feed</div>
          <div class="sidebar-item" data-chat-action="dms" data-chat-id="null">ğŸ’¬ Direct Comms</div>
        </div>
        <div class="sidebar-section" id="streams-section">
          <div class="section-label">Streams</div>
          <div id="streams-list"></div>
          <div class="sidebar-item add-stream-btn" onclick="openCfg()">+ Add Stream</div>
        </div>
        <div class="sidebar-section" id="pending-section" style="display:none;">
          <div class="section-label">Pending DMs</div>
          <div id="pending-list"></div>
        </div>
        <div class="sidebar-section" id="pinned-section" style="display:none;">
          <div class="section-label">ğŸ“Œ Pinned</div>
          <div id="pinned-list"></div>
        </div>
        <div class="sidebar-section">
          <div class="section-header">
            <span class="section-label">Active (6h)</span>
            <button class="sort-toggle" id="sort-btn" data-action="toggle-sort" title="Sort">ğŸ“Š</button>
          </div>
          <div id="active-list"></div>
        </div>
        <div class="sidebar-section">
          <div class="section-header">
            <button class="collapse-toggle" id="inactive-toggle" data-action="toggle-inactive" title="Toggle">â–¶</button>
            <span class="section-label">Inactive (6h+)</span>
          </div>
          <div id="inactive-list" style="display:none;"></div>
        </div>
      </nav>

      <!-- CHAT PANELS -->
      <main id="feed" role="main" aria-label="Chat content">
        <div id="panels-wrap"></div>
      </main>
    </div>
  </div>

  <!-- ====== OVERLAYS & MODALS ====== -->

  <!-- SEARCH -->
  <div class="modal-overlay" id="searchOv">
    <div class="modal-header"><h3>Search Messages</h3><button class="close-btn" onclick="toggleSearch()">âœ•</button></div>
    <input id="searchIn" class="modal-input" placeholder="Search messages..." oninput="doSearch(this.value)">
    <div id="searchRes" class="search-results"></div>
  </div>

  <!-- CONFIG PANEL -->
  <div class="modal-overlay config-panel" id="cfgPanel" style="display:none;">
    <div class="modal-header"><h3>âš™ï¸ Configuration</h3><button class="close-btn" onclick="closeCfg()">âœ•</button></div>
    <div class="cfg-grid">
      <!-- Column 1: Stream Builder -->
      <div class="cfg-col">
        <h4>Create Stream</h4>
        <input id="cfgStreamName" class="cfg-input" placeholder="Stream name">
        <div class="cfg-label">Sound</div>
        <div id="cfgSoundPicker" class="sound-picker">
          <button class="snd-opt sel" data-sound="radar" onclick="selCfgSnd(this)">Radar â–¶</button>
          <button class="snd-opt" data-sound="chime" onclick="selCfgSnd(this)">Chime â–¶</button>
          <button class="snd-opt" data-sound="click" onclick="selCfgSnd(this)">Click â–¶</button>
          <button class="snd-opt" data-sound="alert" onclick="selCfgSnd(this)">Alert â–¶</button>
          <button class="snd-opt" data-sound="sonar" onclick="selCfgSnd(this)">Sonar â–¶</button>
          <button class="snd-opt" data-sound="drop" onclick="selCfgSnd(this)">Drop â–¶</button>
        </div>
        <div class="cfg-label">Groups</div>
        <div id="cfgGroupList" class="cfg-checklist"></div>
        <button class="cfg-save-btn" onclick="saveStream()">Save Stream</button>
      </div>
      <!-- Column 2: Templates & Alerts -->
      <div class="cfg-col">
        <h4>Message Templates</h4>
        <div id="tplMgr"></div>
        <div class="cfg-add-row"><input id="tplNew" class="cfg-input" placeholder="New template"><button class="cfg-add-btn" onclick="addTpl()">+</button></div>
        <h4>Alert Words</h4>
        <div id="alertMgr"></div>
        <div class="cfg-add-row"><input id="alertNew" class="cfg-input" placeholder="New alert word"><button class="cfg-add-btn" onclick="addAlert()">+</button></div>
      </div>
      <!-- Column 3: Audio Settings -->
      <div class="cfg-col">
        <h4>Audio Settings</h4>
        <label class="cfg-chk"><input type="checkbox" id="allNotifChk" onchange="toggleAllNotif(this.checked)"> All Notifications</label>
        <div class="cfg-label">Feed Sound</div>
        <select id="feedSndSel" onchange="setFeedSnd(this.value)">
          <option value="radar">Radar</option><option value="chime">Chime</option><option value="click">Click</option>
          <option value="alert">Alert</option><option value="sonar">Sonar</option><option value="drop">Drop</option>
        </select>
        <label class="cfg-chk"><input type="checkbox" id="feedMutChk" onchange="setFeedMut(this.checked)"> Mute Feed</label>
        <div class="cfg-label">DM Sound</div>
        <select id="dmSndSel" onchange="setDmSnd(this.value)">
          <option value="chime" selected>Chime</option><option value="radar">Radar</option><option value="click">Click</option>
          <option value="alert">Alert</option><option value="sonar">Sonar</option><option value="drop">Drop</option>
        </select>
        <label class="cfg-chk"><input type="checkbox" id="dmMutChk" onchange="setDmMut(this.checked)"> Mute DMs</label>
      </div>
    </div>
  </div>

  <!-- MEMBERS VIEWER -->
  <div class="modal-overlay" id="membersOv">
    <div class="modal-header">
      <div><h3 id="membersTitle">Members</h3><div id="membersSub" class="modal-subtitle"></div></div>
      <button class="close-btn" onclick="hideMembers()">âœ•</button>
    </div>
    <input id="memSearch" class="modal-input" placeholder="Search members..." oninput="filterMembers(this.value)">
    <div id="memList" class="member-list"></div>
  </div>

  <!-- CONTACTS -->
  <div class="modal-overlay" id="contactOv">
    <div class="modal-header"><h3>Contact Directory</h3><button class="close-btn" onclick="hideContacts()">âœ•</button></div>
    <input id="conSearch" class="modal-input" placeholder="Search contacts..." oninput="filterCon(this.value)">
    <div id="conList" class="contact-list"></div>
  </div>

  <!-- AD-HOC BROADCAST -->
  <div class="modal-overlay" id="adhocModal" style="display:none;">
    <div class="modal-header"><h3>ğŸ“¢ Broadcast</h3><button class="close-btn" onclick="hideAdhoc()">âœ•</button></div>
    <textarea id="adhocMsg" class="modal-textarea" placeholder="Broadcast message..."></textarea>
    <div class="cfg-label">Select groups:</div>
    <div id="adhocGroups" class="cfg-checklist"></div>
    <button class="cfg-save-btn" onclick="sendAdhoc()">Send Broadcast</button>
  </div>

  <!-- SHIFT CHANGE -->
  <div class="modal-overlay" id="shiftModal" style="display:none;">
    <div class="modal-header"><h3>ğŸ“‹ Shift Change</h3><button class="close-btn" onclick="hideShiftChange()">âœ•</button></div>
    <div class="shift-form">
      <label>Outgoing:</label><input id="shiftOff" class="cfg-input" placeholder="Name going off">
      <label>Incoming:</label><input id="shiftOn" class="cfg-input" placeholder="Name coming on">
      <label>Phone:</label><input id="shiftPhone" class="cfg-input" placeholder="Phone number">
    </div>
    <div class="cfg-label">Send to:</div>
    <div id="shiftTargets" class="cfg-checklist"></div>
    <button class="cfg-save-btn" onclick="sendShiftChange()">Send Shift Change</button>
  </div>

  <!-- FORWARD MODAL -->
  <div class="modal-overlay" id="fwdModal" style="display:none;">
    <div class="modal-header"><h3>Forward Message</h3><button class="close-btn" onclick="hideFwd()">âœ•</button></div>
    <div id="fwdPreview" class="fwd-preview"></div>
    <div class="cfg-label">Send to:</div>
    <div id="fwdTargets" class="fwd-targets"></div>
  </div>

  <!-- FLOATING CLIPBOARD -->
  <div id="clipboard" class="clipboard" style="display:none;">
    <div class="cb-header" id="cbDrag">
      <span>ğŸ“‹ Clipboard</span>
      <div>
        <span id="cbCount" class="cb-count">0</span>
        <button class="icon-btn-sm" onclick="clearCB()" title="Clear">ğŸ—‘ï¸</button>
        <button class="icon-btn-sm" onclick="toggleCB()" title="Close">âœ•</button>
      </div>
    </div>
    <textarea id="cbText" class="cb-textarea" placeholder="Paste notes here..." oninput="saveCBContent()"></textarea>
  </div>

  <!-- LIGHTBOX -->
  <div id="lightbox" class="lightbox" style="display:none;" onclick="this.style.display='none'">
    <img id="lbImg" src="" alt="Preview">
  </div>

  <!-- STICKY HISTORY -->
  <div class="modal-overlay" id="stickyHistOv" style="display:none;">
    <div class="modal-header"><h3>ğŸ“œ Sticky History</h3><button class="close-btn" onclick="hideStickyHistory()">âœ•</button></div>
    <div id="stickyHistList"></div>
  </div>

  <!-- NOTIFICATIONS -->
  <div id="toast-zone" role="status" aria-live="polite" aria-atomic="true"></div>

  <!-- APPLICATION SCRIPT -->
  <script src="js/app.js"></script>
</body>
</html>
